[phases.setup]
nixPkgs = [
    # PHP y extensiones (verifica nombres actuales en https://search.nixos.org/packages)
    "php84", 
    "php84Extensions.curl",
    "php84Extensions.mbstring",
    "php84Extensions.xml",
    "php84Extensions.fileinfo",
    "nodejs_22",  # Última LTS disponible según tu confirmación
    "yarn"
]

[phases.build]
commands = [
    # Instalación EXPLÍCITA de Composer (método 100% confiable)
    "php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"",
    "php composer-setup.php --install-dir=/usr/bin --filename=composer",
    "php -r \"unlink('composer-setup.php');\"",
    
    # Verifica que Composer esté instalado
    "composer --version",
    
    # Comandos del proyecto
    "composer install --no-interaction --prefer-dist --optimize-autoloader --ignore-platform-reqs",
    "yarn install",
    "yarn prod",
    "php artisan optimize:clear"
]

[start]
cmd = "php artisan serve --host=0.0.0.0 --port=$PORT"
